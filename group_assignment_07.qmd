---
title: "Lab 07 Group Assignment"
format: html
editor: visual
author: 
 - Palliotto Giosuè (s253716)
 - Palova Zoja (s225185)
 - Pålsson Joel Sebastian (s253731)
 - Humaira Amin (s235423)
 - Anas Majed El Youssef (s233381)
execute:
  warning: false
  message: false
---

# Background

The dataset originates from Dr. William H. Wolberg at Wisconsin Hospital. Breast tumor biopsies were assessed for 699 patients, and morphological features were noted as nine attributes scored on a scale 1 to 10. These attributes include, for instance, uniform cell size, epithelial cell size, and number of mitoses. The outcome, benign or malignant, is also known.

## Aim

In this report, we aim to investigate if any of the attributes are significantly correlated with a malignant outcome. In order to capture the variation of the data, we will conduct a principal component analysis.

# Load libraries

```{r load_packages}
#| echo: false

library(tidyverse)
library(broom)
library(dplyr)
library(patchwork)

```

# Load data

```{r load_data}
#| echo: false

biopsy <- read_csv("https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv",
                   show_col_types = FALSE)

write_csv(x = biopsy,
          file = "data/biopsy.csv")
```

# Arrange data

In order to make certain plots, a long format is better. We pivot the data longer, excluding outcome, giving a table with three columns: attribute, value, and outcome.

```{r pivot_long}
biopsy_long <- biopsy |> 
  pivot_longer(cols = !starts_with("o"),     #All columns except "outcome"
               names_to = "attribute",
               values_to = "value")

#Get attributes
attributes <- biopsy_long |> 
  pull(attribute) |>  
  unique()
```

# Analysis

First, we can plot the average attribute values for the two outcomes to see if any pattern appears. In doing so, we see that all attributes have a higher mean (significance not tested) in malignant outcome, but no other pattern can be discerned.

```{r bar_plot_averages}
#| fig-cap: "Figure 1: Bar plot of attribute means"

biopsy_long |>
  group_by(outcome, attribute) |> 
  mutate(value = mean(value)) |> 
  ggplot(aes(x = value, y = attribute, fill = outcome)) +
  geom_col(position = "dodge") +
  theme_minimal() +
  theme(legend.position = "bottom") +
  labs(title = "Mean attribute value stratified by outcome",
       x = "Average",
       y = "Attribute",
       fill = "Outcome")
  
```

If we separate the data by outcome and generate histograms for each attribute, as done in figure 2 and 3 below, we can observe a wider distribution of values for all attributes in malignant outcomes, indicating that these cell populations were less homogeneous in appaerence.

```{r histogram_benign}
#| fig-cap: "Figure 2: Attribute histograms benign outcome"

hist_benign <- biopsy_long |> 
  filter(outcome == "benign") |> 
  ggplot(aes(value)) +
  geom_histogram(bins = 10) +
  facet_wrap(~attribute) +
  labs(title = "Attribute histograms for benign outcomes")

hist_benign

```

```{r histogram_malignant}
#| fig-cap: "Figure 3: Attribute histograms malignant outcome"

hist_malignant <- biopsy_long |> 
  filter(outcome == "malignant") |> 
  ggplot(aes(value)) +
  geom_histogram(bins = 10) +
  facet_wrap(~attribute, scales = "free_x") +
  labs(title = "Attribute histograms for malignant outcomes")

hist_malignant
```
